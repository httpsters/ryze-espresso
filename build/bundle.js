var firebaseRoot="https://shining-fire-6877.firebaseio.com",riseApp=angular.module("riseApp",["ngRoute","riseApp.services","riseApp.controllers","firebase","autocomplete"]);riseApp.config(["$routeProvider","$locationProvider",function(e){e.when("/",{templateUrl:"templates/app.html"}).when("/admin",{templateUrl:"templates/admin.html"}).otherwise({redirectTo:"/"})}]),riseApp.filter("toDate",function(){return function(e){var n=new Date(e);return n.toLocaleString()}}),angular.module("riseApp.services",[]),angular.module("riseApp.controllers",[]),angular.module("riseApp.services").factory("scResolve",["$http","$q",function(e,n){return{resolve:function(o){var s=n.defer();return e({method:"GET",url:"http://api.soundcloud.com/resolve.json?url="+o+"&client_id=e886c21459d731e8ac7aeedcb3c3b4bb"}).success(function(e){s.resolve(e)}).error(function(e){s.reject(e)}),s.promise}}}]),angular.module("riseApp.controllers").controller("AdminCtrl",["$scope","$firebase","$route",function(e,n){var o=n(new Firebase(firebaseRoot+"/songs")),s=n(new Firebase(firebaseRoot+"/queue/next"));e.songs=[],o.$on("value",function(n){e.songs=[];var o=n.snapshot.value;for(var s in o){var r=o[s];r.id=s,e.songs.push(r)}}),e.removeSong=function(e){o.$remove(e.id),s.$on("value",function(n){var o=n.snapshot.value;for(var r in o){var i=o[r];e.id===i&&s.$remove(r)}})}}]),angular.module("riseApp.controllers").controller("LeaderboardCtrl",["$scope","$firebase",function(e){var n=new Firebase(firebaseRoot+"/songs");e.users=[],n.on("value",function(n){var o=n.val();users={};for(var s in o)song=o[s],r=song.added_by,likes=song.likes,r in users?users[r]+=likes:users[r]=likes;e.users=[];for(var r in users)user={},user.username=r,user.likes=users[r],e.users.push(user)})}]),angular.module("riseApp.controllers").controller("LikeSongCtrl",["$scope","$firebase",function(e,n){var o=new Firebase(firebaseRoot+"/songs");e.allSongs=n(o)}]),angular.module("riseApp.controllers").controller("PlayerCtrl",["$scope","$rootScope","$firebase",function(e,n,o){var s=firebaseRoot,r=o(new Firebase(s+"/queue")),i=o(new Firebase(s+"/songs")),t=document.getElementById("sc-widget"),u=SC.Widget(t);n.currentSong={},r.$child("cur").$on("value",function(e){var o=e.snapshot.value,s=n.currentSong=i.$child(o),r=s.url;u.load(r,{auto_play:!0,show_artwork:!0,visual:!0,buying:!1,liking:!1,download:!1,sharing:!1,show_comments:!1,show_playcount:!1,show_user:!1})});var l=o(new Firebase(s+"/queue/next"));n.upcomingSongs=[],l.$on("value",function(e){nextSongs=e.snapshot.value,n.upcomingSongs=[];for(var o in nextSongs)songId=nextSongs[o].key,song=i.$child(songId),song.title&&song.url&&n.upcomingSongs.push(song)})}]),angular.module("riseApp.controllers").controller("RecentlyPlayedCtrl",["$scope","$rootScope","$firebase",function(e,n,o){url=firebaseRoot;var s=o(new Firebase(url+"/songs"));e.allSongs=[],s.$on("value",function(){e.allSongs=[],s.$getIndex().forEach(function(n){song=s.$child(n),song.id=n,e.allSongs.push(song)})}),n.likedSongs={},n.songIsLiked=function(e){return e in n.likedSongs},n.toggleLike=function(e){update={},song=s.$child(e),e in n.likedSongs?(update={likes:song.likes-1},delete n.likedSongs[e]):(update={likes:song.likes+1,last_liked:(new Date).getTime()},n.likedSongs[e]=!0),song.$update(update)}}]),angular.module("riseApp.controllers").controller("SubmitCtrl",["$scope","$firebase","$http","$timeout","scResolve",function(e,n,o,s,r){var i=new Firebase(firebaseRoot+"/songs"),t=new Firebase(firebaseRoot+"/queue/next"),u="e886c21459d731e8ac7aeedcb3c3b4bb";e.submission={url:"",user:""},e.autocomplete="",e.fullSuggestions=[],e.acSuggestions=[],e.acUpdate=function(n){if(n.length<3)return e.submission.url="",void(e.acSuggestions=[]);var s=10,r="http://api.soundcloud.com/tracks.json?q="+n+"&limit="+s+"&client_id="+u;o.get(r).success(function(n){e.fullSuggestions=n;var o=function(e){var n=e.title,o=e.user.username;return""+n+" - "+o},s=_.map(n,o);e.acSuggestions=s})},e.acSelect=function(n){var o=e.fullSuggestions[n];e.submission.url=o.permalink_url},e.submitIsDisabled=function(){var n=function(){var n=e.submission.url;if(!n||""===n)return!1;var o=n.match(/http.*\/\/soundcloud.com\/(.*)\/(.*)/);return null!==o},o=function(){var n=e.submission.user;return n&&""!==n?!0:!1},s=n()&&o();return!s},e.allSongs=n(i),e.userSongs=n(t),e.confShowing=!1,e.showConf=function(){e.confShowing=!0,s(function(){e.confShowing=!1},4e3)},e.submit=function(){var n=e.submission,o=r.resolve(n.url);o.then(function(o){var s={time_added:(new Date).getTime(),added_by:n.user,likes:1,last_liked:(new Date).getTime(),duration:o.duration,title:o.title,play_count:0,url:o.permalink_url,last_played:0};e.allSongs.$add(s).then(function(n){addSongRef={key:n.name(),time_added:(new Date).getTime()},e.userSongs.$add(addSongRef),e.showConf()})},function(){})}}]);